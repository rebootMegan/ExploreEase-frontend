"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.supportScriptName = void 0;
const compiler_sfc_1 = require("@vue/compiler-sfc");
const magic_string_1 = __importDefault(require("magic-string"));
function supportScriptName(code, id) {
    let s;
    const FILENAME_RE = /.*\/(\S*)/;
    const str = () => s || (s = new magic_string_1.default(code));
    const { descriptor } = (0, compiler_sfc_1.parse)(code);
    if (!descriptor.script && descriptor.scriptSetup) {
        const result = (0, compiler_sfc_1.compileScript)(descriptor, { id });
        const name = result.attrs.name;
        const lang = result.attrs.lang;
        const inheritAttrs = result.attrs.inheritAttrs;
        if (name || inheritAttrs) {
            str().appendLeft(0, `<script ${lang ? `lang="${lang}"` : ''}>
import { defineComponent } from 'vue'
export default defineComponent({
  ${name ? `name: "${name}",` : ''}
  ${inheritAttrs ? `inheritAttrs: ${inheritAttrs !== 'false'},` : ''}
})
</script>\n`);
        }
        const map = str().generateMap({ hires: true });
        const filename = FILENAME_RE.exec(id)[1];
        map.file = filename;
        map.sources = [filename];
        return {
            map,
            code: str().toString(),
        };
    }
    else {
        return null;
    }
}
exports.supportScriptName = supportScriptName;
//# sourceMappingURL=lib.js.map